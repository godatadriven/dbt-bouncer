---
name: CI pipeline

on:
    pull_request:
        branches:
            - main
    push:
      branches:
        - test-action

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

env:
  IMAGE_NAME: ${{ github.repository }}
  POETRY_VERSION: "1.7.1"
  REGISTRY: ghcr.io

jobs:
    dbt-test:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - uses: godatadriven/dbt-bouncer@docker-based-action
              with:
                config-file: ./dbt-bouncer-example.yml
                PAT_GITHUB: ${{ secrets.PAT_GITHUB }}

            # - run: echo '${{ secrets.PAT_GITHUB }}' | docker login ghcr.io -u pgoslatara --password-stdin
            # - run: docker pull ghcr.io/godatadriven/dbt-bouncer:v0
            # - run: >
            #     docker run --rm \
            #       --volume "$PWD":/app \
            #       ghcr.io/godatadriven/dbt-bouncer:v0 \
            #       dbt-bouncer/dbt-bouncer.pex --config-file /app/dbt-bouncer-example.yml
