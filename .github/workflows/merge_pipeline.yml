---
  name: Merge pipeline

  on:
    push:
      branches:
        - main

  env:
    POETRY_VERSION: "1.8.3"
    POETRY_VIRTUALENVS_IN_PROJECT: true

  jobs:
      deply-docs:
          runs-on: ubuntu-latest
          steps:
              - uses: actions/checkout@v4

              - name: Fetch tags
                run: git fetch --prune --unshallow --tags

              - name: Determine python version
                id: python-version
                run: |
                    export PYTHON_VERSION=$(cat .python-version)
                    echo "PYTHON_VERSION: $PYTHON_VERSION"
                    echo "PYTHON_VERSION=$PYTHON_VERSION" >> $GITHUB_OUTPUT

              - name: Setup Python
                uses: ./.github/actions/setup_python_env
                with:
                  poetry-version: ${{ env.POETRY_VERSION }}
                  python-version: ${{ steps.python-version.outputs.PYTHON_VERSION }}

              - name: Deploy docs website
                run: |
                  git config --global user.email "bot@github.com"
                  git config --global user.name "github-actions[bot]"
                  poetry run mike deploy --push --update-aliases latest
